<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>map</title>
    <style>
        #mapwrap {
            position: relative;
            overflow: hidden;
        }

        .category,
        .category * {
            margin: 0;
            padding: 0;
            color: #000;
        }

        .category {
            position: absolute;
            overflow: hidden;
            top: 10px;
            left: 10px;
            width: 150px;
            height: 50px;
            z-index: 10;
            border: 1px solid black;
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            font-size: 12px;
            text-align: center;
            background-color: #fff;
        }

        .category .menu_selected {
            background: #FF5F4A;
            color: #fff;
            border-left: 1px solid #915B2F;
            border-right: 1px solid #915B2F;
            margin: 0 -1px;
        }

        .category li {
            list-style: none;
            float: left;
            width: 50px;
            height: 45px;
            padding-top: 5px;
            cursor: pointer;
        }

        .category .ico_comm {
            display: block;
            margin: 0 auto 2px;
            width: 22px;
            height: 26px;
            background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png') no-repeat;
        }

        .category .ico_AED {
            background-position: -10px 0;
        }

        .category .ico_toilet {
            background-position: -10px -36px;
        }

        .category .ico_exit {
            background-position: -10px -72px;
        }
    </style>
</head>

<body>
    <div id="mapwrap">
        <!-- 지도가 표시될 div -->
        <div id="map" style="width:100%;height:1000px;"></div>
        <!-- 지도 위에 표시될 마커 카테고리 -->
        <div class="category">
            <ul>
                <li id="AEDMenu" onclick="changeMarker('AED')">
                    <span class="ico_comm ico_AED"></span>
                    AED
                </li>
                <li id="toiletMenu" onclick="changeMarker('toilet')">
                    <span class="ico_comm ico_toilet"></span>
                    화장실
                </li>
                <li id="exitMenu" onclick="changeMarker('exit')">
                    <span class="ico_comm ico_exit"></span>
                    비상구
                </li>
            </ul>
        </div>
    </div>

    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=817af310d51662edbc59b582c3bd021a"></script>
    <script>
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(35.88785841860048, 128.61137743682414), // 지도의 중심좌표
                level: 2 // 지도의 확대 레벨
            };

        // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
        if (navigator.geolocation) {

            // GeoLocation을 이용해서 접속 위치를 얻어옵니다
            navigator.geolocation.getCurrentPosition(function (position) {

                var lat = position.coords.latitude, // 위도
                    lon = position.coords.longitude; // 경도

                var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
                    message = '<div style="padding:5px;">당신의 위치입니다.</div>'; // 인포윈도우에 표시될 내용입니다

                // 마커와 인포윈도우를 표시합니다
                displayMarker(locPosition, message);

            });

        } else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다

            var locPosition = new kakao.maps.LatLng(35.88785841860048, 128.61137743682414),
                message = 'geolocation을 사용할수 없어요..'

            displayMarker(locPosition, message);
        }

        // 지도에 마커와 인포윈도우를 표시하는 함수입니다
        function displayMarker(locPosition, message) {

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                map: map,
                position: locPosition
            });

            var iwContent = message, // 인포윈도우에 표시할 내용
                iwRemoveable = true;

            // 인포윈도우를 생성합니다
            var infowindow = new kakao.maps.InfoWindow({
                content: iwContent,
                removable: iwRemoveable
            });

            // 인포윈도우를 마커위에 표시합니다 
            infowindow.open(map, marker);

            // 지도 중심좌표를 접속위치로 변경합니다
            map.setCenter(locPosition);
        }

        /* 마커 표시 */

        // AED 자동제세동기 마커가 표시될 좌표 배열입니다
        var AEDPositions = [
            new kakao.maps.LatLng(35.887790, 128.611363),
            new kakao.maps.LatLng(35.887768, 128.611293),
            new kakao.maps.LatLng(35.887283, 128.612057),
        ];

        // 화장실 마커가 표시될 좌표 배열입니다
        var toiletPositions = [
            new kakao.maps.LatLng(35.887778, 128.611858),
            new kakao.maps.LatLng(35.887533, 128.611294),
            new kakao.maps.LatLng(35.887467, 128.611461),
        ];

        // 비상구 마커가 표시될 좌표 배열입니다
        var exitPositions = [
            new kakao.maps.LatLng(35.887603, 128.611962),
            new kakao.maps.LatLng(35.887313, 128.612054),
        ];

        var markerImageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png';  // 마커이미지의 주소입니다. 스프라이트 이미지 입니다
        AEDMarkers = [], // AED 마커 객체를 가지고 있을 배열입니다
            toiletMarkers = [], // 화장실 마커 객체를 가지고 있을 배열입니다
            exitMarkers = []; // 비상구 마커 객체를 가지고 있을 배열입니다


        createAEDMarkers(); // AED 마커를 생성하고 AED 마커 배열에 추가합니다
        createToiletMarkers(); // 화장실 마커를 생성하고 화장실 마커 배열에 추가합니다
        createExitMarkers(); // 비상구 마커를 생성하고 비상구 마커 배열에 추가합니다

        changeMarker('AED'); // 지도에 AED 마커가 보이도록 설정합니다    


        // 마커이미지의 주소와, 크기, 옵션으로 마커 이미지를 생성하여 리턴하는 함수입니다
        function createMarkerImage(src, size, options) {
            var markerImage = new kakao.maps.MarkerImage(src, size, options);
            return markerImage;
        }

        // 좌표와 마커이미지를 받아 마커를 생성하여 리턴하는 함수입니다
        function createMarker(position, image) {
            var marker = new kakao.maps.Marker({
                position: position,
                image: image
            });

            return marker;
        }

        // AED 마커를 생성하고 AED 마커 배열에 추가하는 함수입니다
        function createAEDMarkers() {

            for (var i = 0; i < AEDPositions.length; i++) {

                var imageSize = new kakao.maps.Size(22, 26),
                    imageOptions = {
                        spriteOrigin: new kakao.maps.Point(10, 0),
                        spriteSize: new kakao.maps.Size(36, 98)
                    };

                // 마커이미지와 마커를 생성합니다
                var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                    marker = createMarker(AEDPositions[i], markerImage);

                // 생성된 마커를 AED 마커 배열에 추가합니다
                AEDMarkers.push(marker);
            }
        }

        // AED 마커들의 지도 표시 여부를 설정하는 함수입니다
        function setAEDMarkers(map) {
            for (var i = 0; i < AEDMarkers.length; i++) {
                AEDMarkers[i].setMap(map);
            }
        }

        // 화장실 마커를 생성하고 화장실 마커 배열에 추가하는 함수입니다
        function createToiletMarkers() {
            for (var i = 0; i < toiletPositions.length; i++) {

                var imageSize = new kakao.maps.Size(22, 26),
                    imageOptions = {
                        spriteOrigin: new kakao.maps.Point(10, 36),
                        spriteSize: new kakao.maps.Size(36, 98)
                    };

                // 마커이미지와 마커를 생성합니다
                var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                    marker = createMarker(toiletPositions[i], markerImage);

                // 생성된 마커를 화장실 마커 배열에 추가합니다
                toiletMarkers.push(marker);
            }
        }

        // 화장실 마커들의 지도 표시 여부를 설정하는 함수입니다
        function setToiletMarkers(map) {
            for (var i = 0; i < toiletMarkers.length; i++) {
                toiletMarkers[i].setMap(map);
            }
        }

        // 비상구 마커를 생성하고 비상구 마커 배열에 추가하는 함수입니다
        function createExitMarkers() {
            for (var i = 0; i < exitPositions.length; i++) {

                var imageSize = new kakao.maps.Size(22, 26),
                    imageOptions = {
                        spriteOrigin: new kakao.maps.Point(10, 72),
                        spriteSize: new kakao.maps.Size(36, 98)
                    };

                // 마커이미지와 마커를 생성합니다
                var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                    marker = createMarker(exitPositions[i], markerImage);

                // 생성된 마커를 비상구 마커 배열에 추가합니다
                exitMarkers.push(marker);
            }
        }

        // 비상구 마커들의 지도 표시 여부를 설정하는 함수입니다
        function setExitMarkers(map) {
            for (var i = 0; i < exitMarkers.length; i++) {
                exitMarkers[i].setMap(map);
            }
        }

        // 카테고리를 클릭했을 때 type에 따라 카테고리의 스타일과 지도에 표시되는 마커를 변경합니다
        function changeMarker(type) {

            var AEDMenu = document.getElementById('AEDMenu');
            var toiletMenu = document.getElementById('toiletMenu');
            var exitMenu = document.getElementById('exitMenu');

            // AED 카테고리가 클릭됐을 때
            if (type === 'AED') {

                // AED 카테고리를 선택된 스타일로 변경하고
                AEDMenu.className = 'menu_selected';

                // 화장실과 비상구 카테고리는 선택되지 않은 스타일로 바꿉니다
                toiletMenu.className = '';
                exitMenu.className = '';

                // AED 마커들만 지도에 표시하도록 설정합니다
                setAEDMarkers(map);
                setToiletMarkers(null);
                setExitMarkers(null);

            } else if (type === 'toilet') { // 화장실 카테고리가 클릭됐을 때

                // 화장실 카테고리를 선택된 스타일로 변경하고
                AEDMenu.className = '';
                toiletMenu.className = 'menu_selected';
                exitMenu.className = '';

                // 화장실 마커들만 지도에 표시하도록 설정합니다
                setAEDMarkers(null);
                setToiletMarkers(map);
                setExitMarkers(null);

            } else if (type === 'exit') { // 비상구 카테고리가 클릭됐을 때

                // 비상구 카테고리를 선택된 스타일로 변경하고
                AEDMenu.className = '';
                toiletMenu.className = '';
                exitMenu.className = 'menu_selected';

                // 비상구 마커들만 지도에 표시하도록 설정합니다
                setAEDMarkers(null);
                setToiletMarkers(null);
                setExitMarkers(map);
            }
        } 
    </script>
</body>

</html>